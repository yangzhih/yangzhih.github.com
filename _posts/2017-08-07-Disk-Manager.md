---
layout: post
title: "Linux存储管理"
description: "Linux磁盘管理"
category: articles
tags: [linux,磁盘管理]
comments: false
---

## 写在前面

在Linux系统中如何有效的对存储空间进行有效的利用和管理，是一种很重要的技术。 <br/>
硬盘设备购买回来之后，需要对其分区之后才有高效合理的对其使用，这如同人们会把一个大衣柜分成不同的格子一样，可以根据生活习惯来把衣服分别放置。硬盘分区也是如此，而且计算机中的数据要比生活中的衣物更多，更庞杂。如果都堆积在一起，随着时间的推移，更加难以管理，当然也不利于使用。<br/>
对硬盘分区可以实现数据的分类管理，提高安全性等特点，如果一个分区的数据损坏不至于损坏其他分区中的数据。如何有效的硬盘进行分区，分出多少才合理，这需要对自己的业务需求来划分，主要影响的因素是文件的类型，大小，文件的数量等因素。

## 关于硬盘识别

在CentOS 6版本以前的操作系统发行版本根据硬盘接口的不同，映射在系统上的设备文件名称也不同。IDE接口的硬盘在系统上被识别为hd，第一块为hda,第二块为hdb，以此类推。而SATA,USB和SCSI接口类型的硬盘在系统上被识别为sd,第一块为sda，第二块为sdb，以此类推。从CentOS 6开始IDE接口的硬盘也被系统识别为sd（由于接口速度过慢，在生产环境以及被淘汰）。
对于磁盘的分区，系统用数字表示，第一块硬盘的第一个分区被识别为sda1,第二块硬盘的第二个分区被识别为sda2。当然，这种说法也有欠妥当，对于gpt格式的分区而言这种说法是对的，对于传统的MBR格式的分区而言最多能有四个主分区，有且只有一个扩展分区，分别识别为1，2，3，4，。如果在扩展分区上面建立逻辑分区，那第一个逻辑分区一定是从sda5开始计数的。所有的逻辑分区容量的总和刚好是扩展分区的容量。


## 硬盘分区

- MBR分区

硬盘分区方式常见的有两种，分别为MBR和GPT。MBR为传统的分区方式，最多能建议四个主分区，如下图所示，建立了四个主分区后，即使有剩余空间，也是不能使用的。使用MBR想要使用更多的分区来管理数据，就要建立扩展分区，在扩展分区之上可以建立逻辑分区，如下图2所示。逻辑分区的设备编号一定是从5开始的。

![](http://ot9scj6tc.bkt.clouddn.com/mbr.png)

下面简单介绍一下如何对磁盘进行分区，在Linux系统中，管理分区的工具有很多，比如fdisk,gdisk，parted。

使用fdisk工具对分区进行管理的时候回进入一个交互的界面。它有着许多的子命令。
	
	p   显示磁盘的分区表
		#在主分区加扩展分区为达到4的时候，会让用户选择建立主分区(p)或者扩展分区(e)
		#已有扩展分区后，会让用户选择建立主分区（p)或者逻辑分区(l)。
		#用户可以根据柱面范围来分区或者根据分区的大小来分区。
	n   新建一个分区
	d   删除一个分区
	m   显示帮助信息
	t   修改分区的系统id
	l   列出所有系统id
	w   保存退出
	q   不保存退出 

对磁盘进行分区之后，内核并不一定马上就识别出新的分区，用户可以使用查看/proc/partitions文件来查看是否识别。
若是未识别出新建立的分区，系统若是centos5以前版本，可以使用partprobe [device] 命令来让内核重读分区表；CentOS 6以后版本可以使用partx -[ad] [device]命令来让内核重读分区表。

- GPT分区

对于上文所述的MBR分区方式而言有着诸多弊端，比如最多建立4个主分区，每个分区大小不能超过2TB，而GPT分区则不会有这种限制，而且GPT分区提供了分区表的冗余备份策略，确保了分区表的安全。而MBR分区方式的分区表放在磁盘0磁道0扇区的最后64+2bytes中，64byte用于存放分区表，最后2byte放置分区表表示位 “55 aa”，若是最后的2byte被破坏，系统就会找不到该磁盘的分区表，所以，MBR的这种分区方式相对不太安全。

使用parted分区工具管理磁盘,parted工具可以使用交互界面进行管理，也可以使用命令行方式直接对磁盘进行操作：
	
	parted [device]    #进入交互模式
	
	[root@centos6 ~]#parted /dev/sdc mklabel gpt   #修改分区格式为GPT格式
	[root@centos6 ~]#parted /dev/sdc print		#打印前分区表
	[root@centos6 ~]#parted /dev/sdc mkpart primary ext4 1 2G #创建一个ext4的分区，从1M位置开始到2G位置结束
	[root@centos6 ~]#parted /dev/sdc mkpart primary ext3 2G 4G   #创建一个ext3格式的分区，从2G位置到4G位置结束
	[root@centos6 ~]#parted /dev/sdc print   #查看分区列表，其中有分区标号
	[root@centos6 ~]#parted /dev/sdc rm 2  #删除编号为2的分区
	[root@centos6 ~]#partx -a /dev/sdc   #使内核重读分区表

gdisk 分区工具是一个专门管理GPT分区格式的工具，这里不再多做介绍。 


## 格式化与挂载文件系统

对磁盘分区完毕之后，自然是要对分区进行格式化的，格式化的过程也就是建立文件系统的过程，格式化的命令时mkfs。当然mkfs是一个综合性的工具，它会根据用户的输入去调用内核所支持的文件系统格式化工具软件。